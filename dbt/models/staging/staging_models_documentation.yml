version: 2

models:
  
  # ==================================
  # DIMENSION MODEL: stg_dim_date
  # ==================================
  - name: stg_dim_date
    description: "Staging model for the Date Dimension. This model extracts and transforms the date and time components from the raw fixtures (match) data to create a unique date key for joining with the Fact table."
    columns:
      - name: date_key
        description: "Primary key for the date dimension. Generated by combining the match date and venue ID to ensure uniqueness for each event's specific date and location."
      - name: match_date
        description: "The calendar date of the match (changed type to DATE)."
      - name: match_time
        description: "The specific start time of the match (formatted as HH:MM:SS)."

  # ==================================
  # DIMENSION MODEL: stg_dim_team
  # ==================================
  - name: stg_dim_team
    description: "Staging model for the Team Dimension. This model standardizes team identification columns and cleans team names and locations from the raw team statistics source."
    columns:
      - name: team_key
        description: "Primary key for the Team Dimension. Generated by hashing the raw 'teamId' to ensure a consistent across the data warehouse."
      - name: team_id
        description: "The raw integer ID of the team, used as a human-readable identifier and a link back to raw sources."
      - name: team_name
        description: "The name of the team after trimming whitespace."
      - name: team_location
        description: "The location of the team after trimming whitespace."

  # ==================================
  # DIMENSION MODEL: stg_dim_venue
  # ==================================
  - name: stg_dim_venue
    description: "Staging model for the Venue Dimension. This model standardizes venue attributes."
    columns:
      - name: venue_key
        description: "Primary key for the Venue Dimension. Generated by hashing the raw 'venueId' to ensure a consistent key across the data warehouse."
      - name: venue_id
        description: "The raw integer ID of the venue, used as a link back to raw sources."
      - name: venue_name
        description: "The full name of the venue after trimming whitespace."
      - name: city
        description: "The city where the venue is located."
      - name: country
        description: "The country where the venue is located."

  # ==================================
  # DIMENSION MODEL: stg_dim_weather
  # ==================================
  - name: stg_dim_weather
    description: "Staging model containing one unique hourly weather record for each match event. This model aggregates raw data to eliminate the inherent 24-row per-match duplication issue."
    columns:
      - name: weather_key
        description: "Primary key for the weather dimension. Generated by combining the event_id and the start of the match hour (toStartOfHour). This aggregation is essential, because in the raw data, each match has 24 weather records for each hour of the gameday."
      - name: event_id
        description: "This column is included in the staging layer to generate the weather_key and facilitate the grouping process. It is excluded from the final 'dim_weather' model as the 'weather_key' already captures the relationship.
      - name: latitude
        description: "Latitude of the weather measurement location. The 'any()' function is used here as the value is expected to be constant within the grouped hour."
      - name: longitude
        description: "Longitude of the weather measurement location. The 'any()' function is used here as the value is expected to be constant within the grouped hour."
      - name: timestamp_hour
        description: "The official start time of the weather measurement interval. This column is crucial for the GROUP BY clause and key generation in staging, but is excluded from the final 'dim_weather' model in favor of the 'weather_time' column."
      - name: weather_date
        description: "The calendar date of the weather record (MAX value taken across the grouped hour)."
      - name: temperature
        description: "The temperature (in Celsius) recorded during the corresponding hour of the match.AVG() is used for grouping purposes."
      - name: precipitation
        description: "The average precipitation amount (in mm) for the match. AVG() is used for grouping purposes."
      - name: rainfall
        description: "The average rainfall for the match"
      - name: snowfall
        description: "The average snowfall for the match."
      - name: wind_speed
        description: "The average wind speed for the match."
  
  # ==================================
  # FACT MODEL: stg_fact_match
  # ==================================
  - name: stg_fact_match
    description: "The staging model for the final Fact table. This model links match data with all necessary dimension keys and calculates core aggregated metrics (e.g., total fouls, goals, attendance) for the match event."
    columns:
      - name: match_id
        description: "Primary Key for the Fact table, generated by hashing the unique event ID. This ensures the key is consistent and immutable."
  
      # --- Dimension Keys (Foreign Keys) ---
      - name: date_key
        description: "Foreign Key linking to the dim_date table. Generated from the match's date and venue ID."
      - name: venue_key
        description: "Foreign Key linking to the dim_venue table."
      - name: weather_key
        description: "Foreign Key linking to the dim_weather table."
      - name: home_team_key
        description: "Foreign Key linking to the dim_team table for the home team."
      - name: away_team_key
        description: "Foreign Key linking to the dim_team table for the away team."
        
      # --- Core Metrics (Measures) ---
      - name: home_goals
        description: "The final score achieved by the home team."
      - name: away_goals
        description: "The final score achieved by the away team."
      - name: home_shootout_score
        description: "The final shootout score for the home team (if applicable)."
      - name: away_shootout_score
        description: "The final shootout score for the away team (if applicable)."
      - name: attendance
        description: "The recorded attendance for the match."

      # --- Team Statistics  ---
      - name: home_fouls
        description: "Total fouls committed by the home team."
      - name: away_fouls
        description: "Total fouls committed by the away team."
      - name: home_yellow_cards
        description: "Total yellow cards received by the home team."
      - name: home_red_cards
        description: "Total red cards received by the home team."
      - name: away_yellow_cards
        description: "Total yellow cards received by the away team."
      - name: away_red_cards
        description: "Total red cards received by the away team."
      - name: home_possession_pct
        description: "The home team's percentage of ball possession during the match."
      - name: away_possession_pct
        description: "The away team's percentage of ball possession during the match."
      - name: home_corners
        description: "Total corners won by the home team."
      - name: away_corners
        description: "Total corners won by the away team."